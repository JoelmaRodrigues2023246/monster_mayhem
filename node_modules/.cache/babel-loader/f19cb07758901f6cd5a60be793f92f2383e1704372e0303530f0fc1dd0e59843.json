{"ast":null,"code":"function _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = \"function\" == typeof Symbol ? Symbol : {}, a = i.iterator || \"@@iterator\", c = i.asyncIterator || \"@@asyncIterator\", u = i.toStringTag || \"@@toStringTag\"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, \"\"); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, \"_invoke\", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: \"normal\", arg: t.call(e, r) }; } catch (t) { return { type: \"throw\", arg: t }; } } e.wrap = wrap; var h = \"suspendedStart\", l = \"suspendedYield\", f = \"executing\", s = \"completed\", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { [\"next\", \"throw\", \"return\"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if (\"throw\" !== c.type) { var u = c.arg, h = u.value; return h && \"object\" == _typeof(h) && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) { invoke(\"next\", t, i, a); }, function (t) { invoke(\"throw\", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke(\"throw\", t, i, a); }); } a(c.arg); } var r; o(this, \"_invoke\", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error(\"Generator is already running\"); if (o === s) { if (\"throw\" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else \"return\" === n.method && n.abrupt(\"return\", n.arg); o = f; var p = tryCatch(e, r, n); if (\"normal\" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, \"throw\" === n && e.iterator[\"return\"] && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y; var i = tryCatch(o, e.iterator, r.arg); if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = \"normal\", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: \"root\" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || \"\" === e) { var r = e[a]; if (r) return r.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + \" is not iterable\"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, \"constructor\", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) { var e = \"function\" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () { return this; }), define(g, \"toString\", function () { return \"[object Generator]\"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if (\"throw\" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if (\"root\" === i.tryLoc) return handle(\"end\"); if (i.tryLoc <= this.prev) { var c = n.call(i, \"catchLoc\"), u = n.call(i, \"finallyLoc\"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error(\"try statement without catch or finally\"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) { var i = o; break; } } i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if (\"throw\" === t.type) throw t.arg; return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, \"catch\": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if (\"throw\" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, \"next\" === this.method && (this.arg = t), y; } }, e; }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport { ref, onMounted, onBeforeUnmount } from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport { db } from \"../services/firebaseConfig\";\nimport { doc, onSnapshot, arrayUnion, updateDoc, deleteDoc, addDoc, collection } from \"firebase/firestore\";\nimport { getAuth } from \"firebase/auth\";\nimport { updateLobby, getUserNicknameById } from \"../services/firebaseService\";\nexport default {\n  name: \"Lobby\",\n  setup: function setup() {\n    var route = useRoute();\n    var router = useRouter();\n    var auth = getAuth();\n    var lobbyId = route.params.id;\n    var lobby = ref(null);\n    var isHost = ref(false);\n    var hostNickname = ref(\"\");\n    var playerNicknames = ref([]);\n    var showStartButton = ref(false);\n    var loadLobby = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var lobbyRef;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              lobbyRef = doc(db, \"lobbies\", lobbyId);\n              onSnapshot(lobbyRef, /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(doc) {\n                  return _regeneratorRuntime().wrap(function _callee$(_context) {\n                    while (1) switch (_context.prev = _context.next) {\n                      case 0:\n                        if (!doc.exists()) {\n                          _context.next = 15;\n                          break;\n                        }\n                        lobby.value = doc.data();\n\n                        // Check if the current user is the host\n                        isHost.value = auth.currentUser.uid === lobby.value.host;\n\n                        // Fetch nicknames for the host and players\n                        _context.next = 5;\n                        return getUserNicknameById(lobby.value.host);\n                      case 5:\n                        hostNickname.value = _context.sent;\n                        _context.next = 8;\n                        return Promise.all(lobby.value.players.map(function (playerId) {\n                          return getUserNicknameById(playerId);\n                        }));\n                      case 8:\n                        playerNicknames.value = _context.sent;\n                        if (lobby.value.players.includes(auth.currentUser.uid)) {\n                          _context.next = 12;\n                          break;\n                        }\n                        _context.next = 12;\n                        return updateLobby(lobbyId, {\n                          players: arrayUnion(auth.currentUser.uid)\n                        });\n                      case 12:\n                        // Check if ready to start the game\n                        showStartButton.value = isHost.value && lobby.value.players.length === 4;\n                        _context.next = 17;\n                        break;\n                      case 15:\n                        alert(\"Lobby does not exist anymore.\");\n                        router.push(\"/multiplayer-options\");\n                      case 17:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }, _callee);\n                }));\n                return function (_x) {\n                  return _ref2.apply(this, arguments);\n                };\n              }());\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      return function loadLobby() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    // Start the game\n    var startGame = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var gameRef;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return addDoc(collection(db, \"games\"), {\n                host: lobby.value.host,\n                players: lobby.value.players,\n                state: {},\n                // Initial game state\n                turn: lobby.value.players[0]\n              });\n            case 3:\n              gameRef = _context4.sent;\n              _context4.next = 6;\n              return updateLobby(lobbyId, {\n                status: \"in-game\",\n                gameId: gameRef.id\n              });\n            case 6:\n              // Direct all players to the game page\n              lobby.value.players.forEach( /*#__PURE__*/function () {\n                var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(playerId) {\n                  var playerRef;\n                  return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n                    while (1) switch (_context3.prev = _context3.next) {\n                      case 0:\n                        playerRef = doc(db, \"users\", playerId);\n                        _context3.next = 3;\n                        return updateDoc(playerRef, {\n                          currentGame: gameRef.id\n                        });\n                      case 3:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }, _callee3);\n                }));\n                return function (_x2) {\n                  return _ref4.apply(this, arguments);\n                };\n              }());\n\n              // Ensure the host is redirected to the game page\n              setTimeout(function () {\n                router.push(\"/game/\".concat(gameRef.id));\n              }, 1000); // Add a slight delay to ensure all updates are propagated\n              _context4.next = 13;\n              break;\n            case 10:\n              _context4.prev = 10;\n              _context4.t0 = _context4[\"catch\"](0);\n              console.error(\"Error starting game:\", _context4.t0);\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, null, [[0, 10]]);\n      }));\n      return function startGame() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    var copyLobbyLink = function copyLobbyLink() {\n      var link = lobbyId;\n      navigator.clipboard.writeText(link).then(function () {\n        alert(\"Lobby link copied to clipboard\");\n      });\n    };\n    var handleBeforeUnload = function handleBeforeUnload(event) {\n      if (isHost.value) {\n        event.preventDefault();\n        event.returnValue = \"\";\n      }\n    };\n    var handleLeaveLobby = /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!isHost.value) {\n                _context5.next = 7;\n                break;\n              }\n              if (!confirm(\"If you leave, the lobby will be deleted. Do you want to proceed?\")) {\n                _context5.next = 5;\n                break;\n              }\n              _context5.next = 4;\n              return deleteDoc(doc(db, \"lobbies\", lobbyId));\n            case 4:\n              router.push(\"/multiplayer-options\");\n            case 5:\n              _context5.next = 8;\n              break;\n            case 7:\n              router.push(\"/multiplayer-options\");\n            case 8:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5);\n      }));\n      return function handleLeaveLobby() {\n        return _ref5.apply(this, arguments);\n      };\n    }();\n    onMounted(function () {\n      loadLobby();\n      window.addEventListener(\"beforeunload\", handleBeforeUnload);\n    });\n    onBeforeUnmount(function () {\n      window.removeEventListener(\"beforeunload\", handleBeforeUnload);\n    });\n    return {\n      lobby: lobby,\n      isHost: isHost,\n      hostNickname: hostNickname,\n      playerNicknames: playerNicknames,\n      showStartButton: showStartButton,\n      startGame: startGame,\n      copyLobbyLink: copyLobbyLink,\n      handleLeaveLobby: handleLeaveLobby\n    };\n  },\n  beforeRouteLeave: function beforeRouteLeave(to, from, next) {\n    var auth = getAuth();\n    var isHost = auth.currentUser && auth.currentUser.uid === this.lobby.host;\n    if (isHost) {\n      if (confirm(\"If you leave, the lobby will be deleted. Do you want to proceed?\")) {\n        deleteDoc(doc(db, \"lobbies\", this.$route.params.id)).then(function () {\n          next();\n        });\n      } else {\n        next(false);\n      }\n    } else {\n      next();\n    }\n  }\n};","map":{"version":3,"names":["ref","onMounted","onBeforeUnmount","useRoute","useRouter","db","doc","onSnapshot","arrayUnion","updateDoc","deleteDoc","addDoc","collection","getAuth","updateLobby","getUserNicknameById","name","setup","route","router","auth","lobbyId","params","id","lobby","isHost","hostNickname","playerNicknames","showStartButton","loadLobby","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","lobbyRef","wrap","_callee2$","_context2","prev","next","_ref2","_callee","_callee$","_context","exists","value","data","currentUser","uid","host","sent","Promise","all","players","map","playerId","includes","length","alert","push","stop","_x","apply","arguments","startGame","_ref3","_callee4","gameRef","_callee4$","_context4","state","turn","status","gameId","forEach","_ref4","_callee3","playerRef","_callee3$","_context3","currentGame","_x2","setTimeout","concat","t0","console","error","copyLobbyLink","link","navigator","clipboard","writeText","then","handleBeforeUnload","event","preventDefault","returnValue","handleLeaveLobby","_ref5","_callee5","_callee5$","_context5","confirm","window","addEventListener","removeEventListener","beforeRouteLeave","to","from","$route"],"sources":["F:\\CCT\\2 SEMESTER\\Concurrent_Systems\\CA2\\project-framework\\monster_mayhem\\src\\views\\Login.vue"],"sourcesContent":["<!--src/views/Login.vue-->\r\n<!-- Login form with email or nickname and password fields -->\r\n<!-- Redirects to the home page after successful login -->\r\n\r\n<template>\r\n    <div class=\"lobby\">\r\n      <h1>Lobby</h1>\r\n      <div v-if=\"lobby\">\r\n        <p>Host: {{ hostNickname }}</p>\r\n        <p>Players:</p>\r\n        <ul>\r\n          <li v-for=\"(player, index) in playerNicknames\" :key=\"index\">\r\n            {{ player }}\r\n          </li>\r\n        </ul>\r\n        <p v-if=\"lobby.players.length < 4\">Waiting for more players to join...</p>\r\n        <p v-else>Ready to start the game!</p>\r\n        <button v-if=\"showStartButton\" @click=\"startGame\">\r\n          Start Game\r\n        </button>\r\n        <button @click=\"copyLobbyLink\">Copy Lobby Code</button>\r\n      </div>\r\n      <div v-else>\r\n        <p>Loading lobby...</p>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { ref, onMounted, onBeforeUnmount } from \"vue\";\r\n  import { useRoute, useRouter } from \"vue-router\";\r\n  import { db } from \"../services/firebaseConfig\";\r\n  import {\r\n    doc,\r\n    onSnapshot,\r\n    arrayUnion,\r\n    updateDoc,\r\n    deleteDoc,\r\n    addDoc,\r\n    collection,\r\n  } from \"firebase/firestore\";\r\n  import { getAuth } from \"firebase/auth\";\r\n  import { updateLobby, getUserNicknameById } from \"../services/firebaseService\";\r\n  \r\n  export default {\r\n    name: \"Lobby\",\r\n    setup() {\r\n      const route = useRoute();\r\n      const router = useRouter();\r\n      const auth = getAuth();\r\n      const lobbyId = route.params.id;\r\n      const lobby = ref(null);\r\n      const isHost = ref(false);\r\n      const hostNickname = ref(\"\");\r\n      const playerNicknames = ref([]);\r\n      const showStartButton = ref(false);\r\n  \r\n      const loadLobby = async () => {\r\n        const lobbyRef = doc(db, \"lobbies\", lobbyId);\r\n        onSnapshot(lobbyRef, async (doc) => {\r\n          if (doc.exists()) {\r\n            lobby.value = doc.data();\r\n  \r\n            // Check if the current user is the host\r\n            isHost.value = auth.currentUser.uid === lobby.value.host;\r\n  \r\n            // Fetch nicknames for the host and players\r\n            hostNickname.value = await getUserNicknameById(lobby.value.host);\r\n            playerNicknames.value = await Promise.all(\r\n              lobby.value.players.map((playerId) => getUserNicknameById(playerId))\r\n            );\r\n  \r\n            // Add the current player to the lobby if not already added\r\n            if (!lobby.value.players.includes(auth.currentUser.uid)) {\r\n              await updateLobby(lobbyId, {\r\n                players: arrayUnion(auth.currentUser.uid),\r\n              });\r\n            }\r\n  \r\n            // Check if ready to start the game\r\n            showStartButton.value = isHost.value && lobby.value.players.length === 4;\r\n          } else {\r\n            alert(\"Lobby does not exist anymore.\");\r\n            router.push(\"/multiplayer-options\");\r\n          }\r\n        });\r\n      };\r\n  \r\n      // Start the game\r\n      const startGame = async () => {\r\n        try {\r\n          const gameRef = await addDoc(collection(db, \"games\"), {\r\n            host: lobby.value.host,\r\n            players: lobby.value.players,\r\n            state: {}, // Initial game state\r\n            turn: lobby.value.players[0],\r\n          });\r\n  \r\n          await updateLobby(lobbyId, {\r\n            status: \"in-game\",\r\n            gameId: gameRef.id,\r\n          });\r\n  \r\n          // Direct all players to the game page\r\n          lobby.value.players.forEach(async (playerId) => {\r\n            const playerRef = doc(db, \"users\", playerId);\r\n            await updateDoc(playerRef, {\r\n              currentGame: gameRef.id,\r\n            });\r\n          });\r\n  \r\n          // Ensure the host is redirected to the game page\r\n          setTimeout(() => {\r\n            router.push(`/game/${gameRef.id}`);\r\n          }, 1000); // Add a slight delay to ensure all updates are propagated\r\n  \r\n        } catch (error) {\r\n          console.error(\"Error starting game:\", error);\r\n        }\r\n      };\r\n  \r\n      const copyLobbyLink = () => {\r\n        const link = lobbyId;\r\n        navigator.clipboard.writeText(link).then(() => {\r\n          alert(\"Lobby link copied to clipboard\");\r\n        });\r\n      };\r\n  \r\n      const handleBeforeUnload = (event) => {\r\n        if (isHost.value) {\r\n          event.preventDefault();\r\n          event.returnValue = \"\";\r\n        }\r\n      };\r\n  \r\n      const handleLeaveLobby = async () => {\r\n        if (isHost.value) {\r\n          if (\r\n            confirm(\r\n              \"If you leave, the lobby will be deleted. Do you want to proceed?\"\r\n            )\r\n          ) {\r\n            await deleteDoc(doc(db, \"lobbies\", lobbyId));\r\n            router.push(\"/multiplayer-options\");\r\n          }\r\n        } else {\r\n          router.push(\"/multiplayer-options\");\r\n        }\r\n      };\r\n  \r\n      onMounted(() => {\r\n        loadLobby();\r\n        window.addEventListener(\"beforeunload\", handleBeforeUnload);\r\n      });\r\n  \r\n      onBeforeUnmount(() => {\r\n        window.removeEventListener(\"beforeunload\", handleBeforeUnload);\r\n      });\r\n  \r\n      return {\r\n        lobby,\r\n        isHost,\r\n        hostNickname,\r\n        playerNicknames,\r\n        showStartButton,\r\n        startGame,\r\n        copyLobbyLink,\r\n        handleLeaveLobby,\r\n      };\r\n    },\r\n    beforeRouteLeave(to, from, next) {\r\n      const auth = getAuth();\r\n      const isHost = auth.currentUser && auth.currentUser.uid === this.lobby.host;\r\n  \r\n      if (isHost) {\r\n        if (\r\n          confirm(\r\n            \"If you leave, the lobby will be deleted. Do you want to proceed?\"\r\n          )\r\n        ) {\r\n          deleteDoc(doc(db, \"lobbies\", this.$route.params.id)).then(() => {\r\n            next();\r\n          });\r\n        } else {\r\n          next(false);\r\n        }\r\n      } else {\r\n        next();\r\n      }\r\n    },\r\n  };\r\n  </script>\r\n  \r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}